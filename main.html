<script src="https://assets.crowd.aws/crowd-html-elements.js" xmlns=""></script>

<style>
    h3 {
        margin-top: 10px;
    }

    crowd-card {
        width: 100%;

    }

    .container {
        display: grid;
        grid-template-columns: 2fr 7fr 1fr;
    }

    /*.container > div:last-child {*/
    /*    grid-column: span 8;*/
    /*}*/
    .container > div {
        margin: 10px;
    }

    .column {
        display: grid;
        grid-template-columns: auto;
        grid-template-rows: minmax(150px, max-content) auto;
    }

    /*.container > div:first-child {*/
    /*    grid-column: span 2;*/
    /*}*/

    .card {
        margin: 10px;
    }

    .radio-box {
        margin-bottom: 20px;
        height: fit-content;
        padding-bottom: 10px;
    }
</style>

<div id="errorBox"></div>
<crowd-form>
    <short-instructions>
        Your short instructions here.
    </short-instructions>

    <full-instructions>
        Your full instructions here.
    </full-instructions>
    <div class="container">
        <div class='column' id="left">
            <div class="radio-box" id="firstForm">
                <h3>Looking at the explanation only, The claim is</h3>
                <input type="radio" id="true" name="verdict" value="true"><label for="true">True</label>
                <input type="radio" id="false" name="verdict" value="false"><label for="false">False/Misleading</label>
                <input type="radio" id="unk" name="verdict" value="unknown"><label for="unk">Hard to say</label>
            </div>
            <div>
                <h3>Claim</h3>
                <crowd-card>
                    <div class="card">${claim}</div>
                </crowd-card>
                <h3>Verdict</h3>
                <crowd-card>
                    <div class="card">${verdict}
                    </div>
                </crowd-card>
            </div>
            <span onclick="reset();">Reset</span>
        </div>

        <div class='column' id="right" style="display: none">
            <div class="radio-box">
                <h3>Is the explanation a good summary of the article?</h3>
                <input type="radio" id="rate0" name="rate" value="0"><label for="rate0">0</label>
                <input type="radio" id="rate1" name="rate" value="1"><label for="rate1">1</label>
                <input type="radio" id="rate2" name="rate" value="2"><label for="rate2">2</label>
                <input type="radio" id="rate3" name="rate" value="3"><label for="rate3">3</label>
                <input type="radio" id="rate4" name="rate" value="4"><label for="rate4">4</label>

            </div>
            <div>
                <h3>Article</h3>
                <crowd-card>
                    <div class="card">
                        ${text}
                    </div>
                </crowd-card>
            </div>
        </div>
    </div>
    <!--    <div id="articleQuestions">-->
    <!--        &lt;!&ndash;        <form method action>&ndash;&gt;-->

    <!--        -->
    <!--        &lt;!&ndash;        </form>&ndash;&gt;-->
    <!--    </div>-->


</crowd-form>

<script>
    function reset() {
        document
            .querySelector('crowd-form')
            .querySelectorAll('input[name="rate"]').forEach((e) => e.checked = false);
        document
            .querySelector('crowd-form')
            .querySelectorAll('input[name="verdict"]').forEach((e) => e.checked = false);
        right.style = 'display: none;';
    }

    function uncoverSecondPart() {
        right.style = '';
    }

    document.addEventListener('all-crowd-elements-ready', () => {
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelector('crowd-form')
        //     .form
        //     .setAttribute('style', 'float: right; width: 45%');
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelector('crowd-form footer-content label').innerHTML = 'No evidence to label';
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelector('crowd-form').form.insertAdjacentHTML('beforebegin', '<div id="inline_article" style="float: left; width: 45%; height: 45%; position: relative;"><h2>Claim: <p>' + '${Claim}' + '</p></h2><h2>Explanation: <p>' + '${Explanation}' + '</p></h2>' + articleQuestions + '</div>');
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelector('crowd-form #inline_article')
        //     .appendChild(articleQuestions);
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelectorAll('p')
        //     .forEach((item, index) => {
        //         item.setAttribute('style', 'font-size: 1em;');
        //     });
        // document
        //     .querySelector('crowd-entity-annotation')
        //     .shadowRoot
        //     .querySelectorAll('label')
        //     .forEach((item, index) => {
        //         item.setAttribute('style', 'margin-left: 5px; margin-right: 20px;');
        //     })
        /*document
            .querySelector('crowd-entity-annotation')
            .shadowRoot
            .querySelectorAll('input')
            .forEach((item, index) => { item.required = true; })*/

        firstForm.addEventListener('click', function (event) {
            if (event.target && event.target.matches("input[type='radio']")) {
                uncoverSecondPart();
            }
        });
        document.querySelector('crowd-form').onsubmit = function (event) {
            errorBox.innerHTML = '';
            if (makingSureChecked() === false) {
                console.log(event);
                event.preventDefault();
                console.log(errorBox);
                errorBox.innerHTML = '<crowd-alert type="error">Please assign a rating to every item.</crowd-alert>';
                errorBox.scrollIntoView();
            }
        };
        // document
        //     .querySelector('crowd-form')
        //     .shadowRoot
        //     .querySelector('#actionsContainer')
        //     .querySelector('button')
        //     .addEventListener("click",
        //         function (event) {
        //             if (makingSureChecked() === false) {
        //                 console.log(event);
        //                 event.preventDefault();
        //                 errorBox.innerHTML = '<crowd-alert type="error" dismissible>You must use each label only once.</crowd-alert>';
        //                 errorBox.scrollIntoView();
        //                 return;
        //             }
        //         });


        function makingSureChecked() {
            // body...
            var rates = document
                .querySelector('crowd-form')
                .querySelectorAll('input[name="rate"]');
            var verdicts = document
                .querySelector('crowd-form')
                .querySelectorAll('input[name="verdict"]');
            var rate_flag = false;
            var verdict_flag = false;
            for (i = 0; i < rates.length; i++) {
                if (rates[i].checked) {
                    rate_flag = true;
                    break;
                }
            }
            for (i = 0; i < verdicts.length; i++) {
                if (verdicts[i].checked) {
                    verdict_flag = true;
                    break;
                }
            }
            if (rate_flag && verdict_flag) {
                return true;
            } else {
                return false;
            }

        }
    });
</script>
